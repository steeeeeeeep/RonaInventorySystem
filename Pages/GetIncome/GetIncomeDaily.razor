@page "/dailyIncome"
@layout MainLayout

@inject BikeSparesInventorySystem.Data.Repositories.Repository<Miners> MinersRepository
@inject BikeSparesInventorySystem.Data.Repositories.Repository<Sales> SalesRepository
@inject BikeSparesInventorySystem.Data.Repositories.Repository<Purchases> PurchaseRepository;
@inject BikeSparesInventorySystem.Data.Repositories.Repository<Expenses> ExpensesRepository;
@inject BikeSparesInventorySystem.Data.Repositories.Repository<Contributions> ContributionRepository;
@inject BikeSparesInventorySystem.Data.Services.AuthService AuthService;

@inject ISnackbar Snackbar
@inject IDialogService DialogService

<MudTable Items="@_Sales"
          FixedHeader="@Fixed_header"
          FixedFooter="@Fixed_footer"
          Height="@(Fixed_header || Fixed_footer ? "calc(100vh - 64px - 64px - 64px)" : "")"
          Dense="@Dense"
          Hover="@Hover"
          ReadOnly="@ReadOnly"
          Filter="new Func<Sales,bool>(FilterFunc)"
          HorizontalScrollbar="true"
          @bind-SelectedItem="SelectedItem"
          SortLabel="Sort By"
          CommitEditTooltip="Commit Edit"
          RowsPerPage="25"
          ApplyButtonPosition="@ApplyButtonPosition">
    <ToolBarContent>
        @if (AuthService.IsUserAdmin())
        {
            <MudStack Row="true">
                <MudItem xs="6" md="12">
                    <ImportButton T="Sales" ChangeParentState="StateHasChanged" />
                </MudItem>
                <MudItem xs="6" md="12">
                    <ExportButton T="Sales" />
                </MudItem>
                <MudItem xs="6" md="12">
                    <MudButton StartIcon="@Icons.Material.Filled.Sync" Color="Color.Success" Variant="Variant.Outlined" OnClick="SaveInSales">Sync</MudButton>
                </MudItem>
            </MudStack>
        }
        <MudSpacer />
        <MudStack Row="true">
            <MudTextField @bind-Value="SearchString" Label="Search" Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search" Class="mt-0" Clearable="true"></MudTextField>
            <MudTextField T="string" Class="mt-0" Label="Filter " InputType="InputType.Month" Clearable="true" Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.FilterAlt" ValueChanged="(a) => FilterByMonth(a)" />
        </MudStack>
    </ToolBarContent>
    <HeaderContent>
        <MudTh Style="white-space: nowrap;"><MudTableSortLabel SortBy="new Func<Sales, object>(x => x.DailyDate)">Date</MudTableSortLabel></MudTh>
        <MudTh Style="white-space: nowrap;"><MudTableSortLabel SortBy="new Func<Sales, object>(x => x.GrossSale)">Gross Sales</MudTableSortLabel></MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd Style="white-space: nowrap;" DataLabel="Miners Date">@context.DailyDate.ToString("dd/MM/yyyy")</MudTd>
        <MudTd Style="white-space: nowrap;" DataLabel="Gross Sale">@context.GrossSale</MudTd>
    </RowTemplate>
    <PagerContent>
        <MudTablePager PageSizeOptions="new int[] { 10, 25, 50, 100, 200, 300,}" />
    </PagerContent>
</MudTable>

